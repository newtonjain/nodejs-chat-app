'use strict';
var request = require('request');
var ResourceProviderHttp = (function () {
    function ResourceProviderHttp(metadataUri) {
        this.metadataUri = metadataUri;
        this.waiters = [];
    }
    ResourceProviderHttp.prototype.getResourceDefinitions = function (callback) {
        if (!this.resources) {
            this.waiters.push(callback);
            if (this.waiters.length === 1) {
                var that_1 = this;
                var notifyWaiters_1 = function () {
                    while (that_1.waiters.length > 0) {
                        var waiter = that_1.waiters.pop();
                        waiter(that_1.resources);
                    }
                    ;
                };
                request(this.metadataUri, function (metadataErr, metadataRes, metadataBody) {
                    if (metadataErr) {
                        throw metadataErr;
                    }
                    var metadata = JSON.parse(metadataBody);
                    var exportConfigUri = metadata.resources[ResourceProviderHttp.EXPORT_CONFIG_RESOURCE_NAME];
                    if (exportConfigUri) {
                        request(exportConfigUri, function (exportErr, exportRes, exportBody) {
                            if (exportErr) {
                                throw exportErr;
                            }
                            that_1.resources = JSON.parse(exportBody);
                            notifyWaiters_1();
                        });
                    }
                    else {
                        that_1.resources = {};
                        notifyWaiters_1();
                    }
                });
            }
        }
        else {
            callback(this.resources);
        }
    };
    ResourceProviderHttp.EXPORT_CONFIG_RESOURCE_NAME = 'export-config';
    return ResourceProviderHttp;
}());
exports.ResourceProviderHttp = ResourceProviderHttp;

//# sourceMappingURL=../../maps/configuration/ResourceProviderHttp.js.map
