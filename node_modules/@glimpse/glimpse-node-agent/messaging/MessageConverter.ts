'use strict';

import { IContext } from './IContextManager';
import { IMessage } from './IMessage';
import {GuidHelper} from './../util/GuidHelper';

export class MessageConverter {
    private static i = 0;

    public static convertMessage(data, types: string[], indices: Object, context: IContext): IMessage {
        const message: IMessage = {
            id: GuidHelper.newGuid(false),
            context: {
                id: context.id,
                type: context.type
            },
            ordinal: ++MessageConverter.i,
            types: types,
            indices: indices,
            payload: undefined
        };

        const payload = {
            id: message.id,
            payload: data,
            ordinal: message.ordinal,
            context: message.context,
            types: types
        };

        message.payload = JSON.stringify(payload);

        return message;
    };
}
