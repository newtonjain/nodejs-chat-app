'use strict';

import { IMessagePublisher } from './IMessagePublisher';
import { IResourceProvider } from '../configuration/IResourceProvider';

import * as request from 'request';

export class MessagePublisherHttp implements IMessagePublisher {
    private static messageIngressTemplate = 'messageIngressTemplate';

    public constructor(private resourceProvider: IResourceProvider) {
    }

    public publishMessages(messages) {
        this.resourceProvider.getResourceDefinitions(resources => {
            const options = {
                uri: resources[MessagePublisherHttp.messageIngressTemplate],
                method: 'POST',
                json: true,
                body: messages
            };

            request(options, function onResponse(err) {
                if (err) {
                    throw err;
                }
            });
        });
    };
}
